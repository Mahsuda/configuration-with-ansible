---
- name: r1soft playbook
  hosts: all
  become: true
  become_method: sudo
  connection: ssh
  ignore_errors: false
  tasks:
    - name: creates a repo
      copy:
        src: r1soft.repo
        dest: /etc/yum.repos.d/r1soft.repo


    - name: Install R1soft
      packages:
        name: serverbackup-enterprise-agent
        state: latest


    - name: Poweroff IP tabeles
      systemd:
        name: firewalld
        state: stopped
      ignore_errors: true


    - name: Get Key
      shell: r1soft-setup --get-key  backup.maqsudat.net


    - name: Start r1soft agent
      systemd:
        name: sbm-agent
        state: restarted

        